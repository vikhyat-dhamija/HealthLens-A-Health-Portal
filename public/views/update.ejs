<!DOCTYPE html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Copse' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/221ff96759.js" crossorigin="anonymous"></script>
    <!-- Include Plotly.js --><script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
  .header {
    color: #36A0FF;
    font-size: 27px;
    padding: 10px;
}

.bigicon {
    font-size: 35px;
    color: #36A0FF;
}
label {
  margin-right: 20px;
}

input[type="radio"]{margin-right: 20px ;}
</style>
</head>
<body >

  
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://http://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>    

<div class="row">
    <div class="col-lg-12">
       <nav class="navbar navbar-expand-lg navbar-dark bg-primary" >
           <ul class="nav justify-content-end"> 
              <li class="nav-item" class="nav justify-content-end">   
                  <a class="navbar-brand" href="#">HealthLens</a>
                  </li>
            <li class="nav-item" class="nav justify-content-end"> 
           <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
           </form>
           </li>
        </ul>
        <ul class="navbar-nav ml-auto">
           <li class="nav-item" class="nav justify-content-end">
           <input type="button" id="log_out" name="log_out" value="LogOut" class="btn btn-primary" > 
          </li>
        </ul>
    </nav>
        </div>
      

</div>

<div class="row">
    <div class="col-lg-2">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary flex-column" class="height:100%">
            <img src='../images/user.png' alt="John" style="width:60%;height: 60%;position: relative; display: block;margin-left: auto;margin-right: auto">
            <% var username %>
            <label id="user_name" value='<%= username %>' class="navbar-brand" ><%= username %></label>           
            <ul class="nav flex-column">

                <li class="nav-item">
                  <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                      <a class="navbar-brand" href="#" ></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                  <a class="navbar-brand" href="#" ></a>
              </li>
              <li class="nav-item">
                <a class="navbar-brand" href="#" ></a>
            </li>
            <li class="nav-item">
              <a class="navbar-brand" href="#" ></a>
          </li>
          <li class="nav-item">
            <a class="navbar-brand" href="#" ></a>
        </li>
        <li class="nav-item">
            <a class="navbar-brand" href="#" ></a>
        </li>
        <li class="nav-item">
          <a class="navbar-brand" href="#" ></a>
      </li>
      <li class="nav-item">
        <a class="navbar-brand" href="#" ></a>
    </li>
    <li class="nav-item">
      <a class="navbar-brand" href="#" ></a>
  </li>
              </ul>
                     
        </nav> 
      </div>

    <div class="col-lg-7">
        
        <div class="row justify-content-center">
    <div class="container">       
                <div>
                    <form class="form-horizontal" onsubmit="return false">
                        <fieldset>
                            <div class="form-group">
                                <span class="col-md-1 col-md-offset-2 text-center"><img src='../images/user_icon.png' alt="John" style="width:4%"></span>
                                <div class="col-md-10">
                                    <input id="f_name" name="f_name" type="text" maxlength="20" onkeypress="return (event.charCode > 64 && event.charCode < 91) || (event.charCode > 96 && event.charCode < 123)" placeholder="First Name" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <span class="col-md-1 col-md-offset-2 text-center"><img src='../images/user_icon.png' alt="John" style="width:4%"></span>
                                <div class="col-md-10">
                                    <input id="l_name" name="l_name" type="text" maxlength="20" onkeypress="return (event.charCode > 64 && event.charCode < 91) || (event.charCode > 96 && event.charCode < 123)" placeholder="Last Name" class="form-control">
                                </div>
                            </div>
    
                            <div class="form-group">
                                <span class="col-md-1 col-md-offset-2 text-center"><img src='../images/user_icon.png' alt="John" style="width:4%"></span>
                                <div class="col-md-10">
                                    <input id="age" name="age" type="number" placeholder="AGE in range 1 to 100 with natural numbers only " max="100" min="1" step="1" class="form-control">
                                    <div id="errors_age" style="color: red;"></div>
                                 </div>
                                
                            </div>
    
                            <div class="form-group">
                                <span class="col-md-1 col-md-offset-2 text-center"><img src='../images/user_icon.png' alt="John" style="width:4%"></span>
                                <div class="col-md-10">
                                    <input id="weight" name="weight" type="number" max="600" min="10" step="0.01" placeholder="Weight in range 10-600 pounds in 2 decimal points" class="form-control">
                                    <div id="errors_weight" style="color: red;"></div>
                                
                                </div>
                                
                            </div>
    
                            <div class="form-group">
                                <span class="col-md-1 col-md-offset-2 text-center"><img src='../images/user_icon.png' alt="John" style="width:4%"></span>
                                <div class="col-md-10">
                                    <input id="height" name="height" type="number" max="132" min="10" step="0.1" placeholder="Height in range 132-10 in inches in 1 decimal point( 1 foot = 12 inches)" class="form-control">
                                    <div id="errors_height" style="color: red;"></div>
                                </div>
                                
                            </div>

                            <div class="form-group">
                                <span class="col-md-1 col-md-offset-2 text-center"><img src='../images/user_icon.png' alt="John" style="width:4%"></span>
                                
                                <div style="padding:40px">
                                    
                                    <input type="radio" class="form-check-input radio-inline" name="gender" id="gender"  value="Male" >
                                    <label class="form-check-label" for="gender" >MALE</label>
                               
                                    <input type="radio" class="form-check-input radio-inline" name="gender" id="gender"  value="Female" >
                                    <label class="form-check-label" for="gender">FEMALE</label>
                                 
                                    <input type="radio" class="form-check-input radio-inline" name="gender" id="gender"  value="Others" >
                                    <label class="form-check-label" for="gender">OTHERS</label>
                                </div>   
                            </div>
    
                            <div class="form-group">
                                <div class="col-md-16 text-center">
                                    <button type="submit" class="btn btn-primary btn-lg" id="submit" name="submit" >Submit</button>
                                      
                                                              
                                </div>
                                
                            </div>
                            
                            
                        </fieldset>
                        
                    </form>
                    <div id="errors_div1" style="color: red;"></div>     
                    
                                    
                                        
                </div>
                
        </div>
    </div>
                
    </div>
  


</div>


<script
src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js">
</script>

<script
src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js">
</script>

<script
src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.6.0/qs.min.js">
</script>

<script>
 function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}   
var el=document.getElementById('user_name');
var username = (el.innerText || el.textContent);
var token=readCookie('auth'+username);

function isNumeric(num){
    num = "" + num; //coerce num to be a string
    return !isNaN(num) && !isNaN(parseFloat(num));
}

a_health=document.getElementById('health');

a_cpmparison=document.getElementById('comparison');

a_useful=document.getElementById('useful');


document.querySelector('#log_out').addEventListener('click',()=>{


document.location.assign('/sign_out/'+token)

})

document.querySelector('#submit').addEventListener('click',(e)=>{
    
    e.preventDefault()

    var flag_errors=0
    var i=0
    var name=document.getElementById('f_name').value +' '+ document.getElementById('l_name').value
    var age=document.getElementById('age').value
    var weight=document.getElementById('weight').value
    var height=document.getElementById('height').value
    var sex=""
    var ele = document.getElementsByName('gender'); 

    var errors_age=document.getElementById("errors_age")
    var errors_height=document.getElementById("errors_height")
    var errors_weight=document.getElementById("errors_weight")
    var errors_div=document.getElementById("errors_div1")

    errors_div.innerHTML=""
    errors_age.innerHTML=""
    errors_height.innerHTML=""
    errors_weight.innerHTML=""

    //checking the length of all the text boxes whether they are not empty as at least some needs to be there 
    if((age.length == 0 ) || (weight.length == 0) || (height.length == 0) )
    {
      errors_div.innerHTML+='<p>'+"Fields can not be empty and must be numbers only as specified"+'</p>'
      flag_errors=1
      console.log("first")
    }


    if((age.length) != 0)
    {
        if(!isNumeric(age) )
        {
                console.log("Please enter a valid age")
                errors_age.innerHTML+="Please enter a valid age"
                flag_errors=1
        }
        else if(parseInt(age) > 100  || parseInt(age) < 1 )
        {
            console.log("Please enter a age in range")
                errors_age.innerHTML+="Please enter the age within range"
                flag_errors=1
        }
    }
     
    if((weight.length) != 0)
    {
        if(!isNumeric(weight) )
        {
                errors_weight.innerHTML+="Please enter a valid weight"
                flag_errors=1
        }
        else if(parseFloat(weight) > 600  || parseFloat(weight) < 10 )
        {
                errors_weight.innerHTML+="Please enter the weight within range"
                flag_errors=1
        }
    }
    
    if((height.length) != 0)
    {
        if(!isNumeric(height) )
        {
                errors_height.innerHTML+="Please enter a valid weight"
                flag_errors=1
        }
        else if(parseFloat(height) > 132  || parseFloat(height) < 10 )
        {
                errors_height.innerHTML+="Please enter the height within range"
                flag_errors=1
        }
    }


    for(i = 0; i < ele.length; i++) { 
        if(ele[i].checked)
        {           
             sex=ele[i].value
             break;
        } 
                
    }

    var data={ name:name,age:age,weight:weight,height:height,sex:sex}
    

if(!flag_errors){

fetch('/update_page/'+token, {
        method: 'POST', 
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
}).then(response => response.json()).then(data => {

    setTimeout(function () {        
        document.location.assign('/biodata/'+token)
        }, 3000) 
  
}).catch((error) => {
  console.error('Error:', error);
});
    
}

})

window.onload=function(){

fetch('/biodata2/'+token).then(response => response.json()).then((data)=> 
{

 if(data.name.length !=0)
 {
    var s = data.name;
    console.log(s)
    var i = s.indexOf(' ');
    var partOne = s.slice(0, i).trim();
    var partTwo = s.slice(i + 1, s.length).trim();
    
    document.getElementById('f_name').value=partOne
    document.getElementById('l_name').value=partTwo

    document.getElementById('f_name').disabled = true;
    document.getElementById('l_name').disabled = true;

 }

}
)}  
</script>
</body>