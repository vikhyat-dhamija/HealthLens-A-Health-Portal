<!DOCTYPE html>
<head>
    <script src="https://kit.fontawesome.com/221ff96759.js" crossorigin="anonymous"></script>
    <!-- Include Plotly.js --><script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<style>
  .header {
    color: #36A0FF;
    font-size: 27px;
    padding: 10px;
}

.bigicon {
    font-size: 35px;
    color: #36A0FF;
}


body {
  font-family: Arial;
}

input[type=number], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=submit] {
  width: 100%;
  background-color: #007bff;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: gray;
}

div.container {
  border-radius: 5px;
  background-color: gainsboro;
  padding: 20px;
}
</style>
</style>

<body >

  
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://http://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>    

</script>

<div class="row">
    <div class="col-lg-12">
       <nav class="navbar navbar-expand-lg navbar-dark bg-primary" >
           <ul class="nav justify-content-end"> 
              <li class="nav-item" class="nav justify-content-end">   
                  <a class="navbar-brand" href="#">HealthLens</a>
                  </li>
            <li class="nav-item" class="nav justify-content-end"> 
           <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
           </form>
           </li>
        </ul>
        <ul class="navbar-nav ml-auto">
         <li >
         <input type="button" id="log_out" name="log_out" value="LogOut" class="btn btn-primary" > </input>
        </li>
        </ul>
        </div>
      </nav>

</div>
<div class="row">
    <div class="col-lg-2">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary flex-column" class="height:100%">
          <img src='../images/user.png' alt="John" style="width:60%;height: 60%;position: relative; display: block;margin-left: auto;margin-right: auto">
            <% var username %>
            
            <label id="user_name" value='<%= username %>' class="navbar-brand" ><%= username %></label>
            
            <ul class="nav flex-column">

                <li class="nav-item">
                  <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                  <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                  <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                  <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                  </li>
                  <li class="nav-item">
                      <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                      <a class="navbar-brand" href="#" ></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                  </li>
                  <li class="nav-item">
                      <a class="navbar-brand" href="#"></a>
                  </li>
                  <li class="nav-item">
                      <a class="navbar-brand" href="#" ></a>
                  </li>
                  <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                  <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                  <a class="navbar-brand" href="#" ></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#"></a>
                </li>
                <li class="nav-item">
                    <a class="navbar-brand" href="#" ></a>
                </li>
              </ul>
                     
        </nav> 
      </div>

    
             
              
                    <div class="container">
                        <form onsubmit="return false" >
                          <label for="bp_sys">Blood Pressure Systolic</label>
                          <input id="bp_sys" name="bp_sys" type="number"  step="1"  min="50" max="250" placeholder="Systolic BP Min: 50 Max:250 Normal:120" onkeypress="return isNumberKey(this, event);">
                           <div id="errors_bp_sys"></div>
                          <label for="bp_dias">Blood Pressure Diastolic</label>
                          <input id="bp_dias" name="bp_dias" type="number" placeholder="Diastolic BP Min: 30 Max:150 Normal:80" step="1" min="30" max="150" onkeypress="return isNumberKey(this, event);">
                          <div id="errors_bp_dias" ></div>
                          <label for="cholestrol">Total Cholestrol</label>
                          <input id="cholestrol" name="cholestrol" type="number" step="0.5" placeholder="Cholestrol Min: 10 Max:700 Normal:below 200"  min="10" max="700" onkeypress="return isNumberKey(this, event);" >
                          <div id="errors_cholestrol"></div>
                          <label for="sugar">Total Sugar</label>
                          <input id="sugar" name="sugar" type="number" placeholder="Sugar in mg/dL Min:30 Max:500  Normal:around 130" step="0.1" onkeypress="return isNumberKey(this, event);">
                          <div id="errors_sugar" ></div>
                          <label for="sugar">Total Uric Acid</label> 
                          <input id="uacid" name="uacid" type="number" placeholder="Uric Acid in mg/dL Min: 2 Max:10 Normal:around 4" step="0.1" min="2" max="10" onkeypress="return isNumberKey(this, event);">
                          <div id="errors_uacid"></div>
                          <input type="submit" value="Submit" id="submit" name="submit" >
                        </form>
                        <div id="errors" ></div>
                      </div>                   
                
            
       
    
    </div>
    


<script
src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js">
</script>

<script
src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js">
</script>

<script
src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.6.0/qs.min.js">
</script>

<script>
 function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}   

var el=document.getElementById('user_name');
var username = (el.innerText || el.textContent);
var token=readCookie('auth'+username);


function isNumeric(num){
    num = "" + num; //coerce num to be a string
    return !isNaN(num) && !isNaN(parseFloat(num));
}

a_health=document.getElementById('health');

a_cpmparison=document.getElementById('comparison');

a_useful=document.getElementById('useful');


document.querySelector('#log_out').addEventListener('click',()=>{


document.location.assign('/sign_out/'+token)

})

document.querySelector('#submit').addEventListener('click',(e)=>{
    
  var errors_div=document.getElementById('errors')
  var errors_bp_sys=document.getElementById('errors_bp_sys')
  var errors_bp_dias=document.getElementById('errors_bp_dias')
  var errors_cholestrol=document.getElementById('errors_cholestrol')
  var errors_sugar=document.getElementById('errors_sugar')
  var errors_uacid=document.getElementById('errors_uacid')
 
  //resetting all their values to empty so as to remove the previous errors
  errors_div.innerHTML=""
  errors_bp_sys.innerHTML=""
  errors_bp_dias.innerHTML=""
  errors_cholestrol.innerHTML=""
  errors_sugar.innerHTML=""
  errors_uacid.innerHTML=""

  e.preventDefault()

  var flag_errors=0

    //First Local Validation whether the right data has been input 
    var i=0
    var b_sys=document.getElementById('bp_sys').value 
    var b_dias=document.getElementById('bp_dias').value
    var chol=document.getElementById('cholestrol').value
    var sug=document.getElementById('sugar').value 
    var uac = document.getElementById('uacid').value 
    var data={ bp_sys:b_sys,bp_dias:b_dias,cholestrol:chol,sugar:sug,uacid:uac}

    //checking the length of all the text boxes whether they are not empty as at least some needs to be there 
    if((data.bp_sys.length == 0 ) && (data.bp_dias.length == 0) && (data.sugar.length == 0) && (data.cholestrol.length == 0) && (data.uacid.length == 0))
    {
      errors_div.innerHTML+="All fields can not be empty and must be numbers only as specified"
      flag_errors=1
    }
    
    //checking the bp_sys_data    
    if((data.bp_sys.length) != 0)
    {
        if(!isNumeric(data.bp_sys) )
        {
                errors_bp_sys.innerHTML+="Please enter a valid Number for BP"
                flag_errors=1
        }
        else if(parseInt(data.bp_sys) > 250  || parseInt(data.bp_sys) < 50 )
        {
                errors_bp_sys.innerHTML+="Please enter the Systolic BP within range"
                flag_errors=1
        }
    }

    //checking the bp_dias_data
    if((data.bp_dias.length) != 0)
    {
        if(!isNumeric(data.bp_dias) )
        {
                errors_bp_dias.innerHTML+="Please enter a valid Number for BP diastolic"
                flag_errors=1
        }
        else if(parseInt(data.bp_dias) < 30  || parseInt(data.bp_dias) > 150 )
        {
                errors_bp_dias.innerHTML+="Please enter the Diastolic BP within range"
                flag_errors=1
        }
    }
    
    //checking the sugar value
    if((data.sugar.length) != 0)
    {
        if(!isNumeric(data.sugar) )
        {
                errors_sugar.innerHTML+="Please enter a valid Number for Sugar Value"
                flag_errors=1
        }
        else if(parseFloat(data.sugar) < 30  || parseFloat(data.sugar) > 500 )
        {
                errors_sugar.innerHTML+="Please enter the Sugar value within range"
                flag_errors=1
        }
    }

    //checking the cholestrol value
    if((data.cholestrol.length) != 0)
    {
        if(!isNumeric(data.cholestrol) )
        {
                errors_cholestrol.innerHTML="Please enter a valid Number for Cholestrol Value"
                flag_errors=1
        }
        else if(parseInt(data.cholestrol) < 10  || parseInt(data.cholestrol) > 700 )
        {
                errors_cholestrol.innerHTML +="Please enter the Sugar value within range"
                flag_errors=1
        }
    }

    //checking the uric acid value
    if((data.uacid.length) != 0)
    {
        if(!isNumeric(data.uacid) )
        {
                errors_uacid.innerHTML="Please enter a valid Number for Uric Acid Value"
                flag_errors=1
        }
        else if(parseInt(data.uacid) < 2  || parseInt(data.uacid) > 10 )
        {
                errors_uacid.innerHTML+="Please enter the Uric Acid value within range"
                flag_errors=1
        }
    }

if(!flag_errors){

    fetch('/health_/'+token, {
        method: 'POST', 
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
}).then(response => response.json()).then(data => {


  document.getElementById('errors').innerHTML+='<b>'+'Data submitted successfully'+'</b>'
    //after certain time may get on to that page where the health data is being displayed
    setTimeout(function () {        
        document.location.assign('/health_/'+token);
        }, 3000)
   
  
}).catch((error) => {
  
  document.getElementById('errors').innerHTML+=error;
  //console.error('Error:', error);
});
}    

})


//Prevent the page from typing the non numbers with decimal and take care that no decimal is repeated
function isNumberKey(txt, evt) {
      var charCode = (evt.which) ? evt.which : evt.keyCode;
      if (charCode == 46) {
        //Check if the text already contains the . character
        if (txt.value.indexOf('.') === -1) {
          return true;
        } else {
          return false;
        }
      } else {
        if (charCode > 31 &&
          (charCode < 48 || charCode > 57))
          return false;
      }
      return true;
    }
</script>
</body>